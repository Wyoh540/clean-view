<!--
=============================================================================
SYNC IMPACT REPORT
=============================================================================
Version change: N/A → 1.0.0 (Initial creation)

Modified principles: N/A (new constitution)

Added sections:
- Core Principles (4 principles)
  - I. Code Quality Standards
  - II. Testing Standards
  - III. User Experience Consistency
  - IV. Performance Requirements
- Quality Gates
- Development Workflow

Removed sections: N/A

Templates requiring updates:
- ✅ plan-template.md - Constitution Check section aligns with principles
- ✅ spec-template.md - Requirements and Success Criteria support UX/Performance metrics
- ✅ tasks-template.md - Phase structure supports testing and quality gates

Follow-up TODOs: None
=============================================================================
-->

# Clean-View Constitution

## Core Principles

### I. Code Quality Standards

所有代码必须遵循严格的质量标准，确保可维护性、可读性和可扩展性。

**强制规则：**

- **可读性优先**：代码必须自文档化，使用清晰的命名约定（变量、函数、类名必须表达其用途）
- **单一职责**：每个模块、类、函数必须只做一件事并做好它
- **DRY原则**：禁止重复代码，公共逻辑必须抽象为可复用组件
- **代码审查**：所有代码变更必须经过代码审查后才能合并到主分支
- **静态分析**：代码必须通过配置的 linter 和格式化工具检查，零警告零错误
- **类型安全**：优先使用强类型语言特性，禁止使用 `any` 类型（TypeScript）或等效的弱类型

**理由**：高质量代码降低维护成本，减少缺陷，提升团队协作效率。

### II. Testing Standards

测试是质量保证的核心，必须贯穿整个开发生命周期。

**强制规则：**

- **测试覆盖率**：核心业务逻辑代码测试覆盖率必须达到 80% 以上
- **测试金字塔**：遵循单元测试(70%) > 集成测试(20%) > 端到端测试(10%) 的比例
- **测试先行（TDD 可选）**：对于复杂业务逻辑，推荐采用测试驱动开发
- **契约测试**：API 接口变更必须包含契约测试验证向后兼容性
- **测试可重复性**：所有测试必须可独立运行，不依赖外部状态或执行顺序
- **测试命名**：测试用例名称必须描述场景、操作和预期结果（Given-When-Then）

**测试类型要求：**

| 测试类型 | 必需场景 | 验证重点 |
|---------|---------|---------|
| 单元测试 | 所有业务逻辑 | 函数级别正确性 |
| 集成测试 | 模块交互、数据库操作 | 组件间通信 |
| 端到端测试 | 核心用户流程 | 完整功能验证 |
| 性能测试 | 关键路径 | 响应时间和吞吐量 |

**理由**：全面的测试策略确保软件质量，降低回归风险，支持持续交付。

### III. User Experience Consistency

用户体验必须统一、直观、无障碍，确保所有交互符合设计系统规范。

**强制规则：**

- **设计系统遵从**：所有 UI 组件必须使用项目定义的设计系统，禁止随意创建自定义样式
- **响应式设计**：界面必须适配主流设备尺寸（移动端、平板、桌面端）
- **无障碍性（A11Y）**：必须满足 WCAG 2.1 AA 级标准，包含键盘导航、屏幕阅读器支持、颜色对比度
- **加载状态**：所有异步操作必须有明确的加载指示和错误反馈
- **交互反馈**：用户操作必须在 100ms 内提供视觉反馈
- **错误处理**：错误信息必须用户友好，提供明确的解决方案或下一步操作

**一致性检查清单：**

- [ ] 组件复用设计系统定义的基础组件
- [ ] 间距、字体、颜色使用设计令牌（Design Tokens）
- [ ] 交互模式（按钮、表单、导航）保持全局一致
- [ ] 国际化（i18n）支持已实现（如适用）

**理由**：一致的用户体验提升用户满意度和产品专业度，降低用户学习成本。

### IV. Performance Requirements

系统必须满足定义的性能指标，确保用户体验流畅和系统可扩展。

**强制规则：**

- **响应时间**：
  - API 响应 P95 ≤ 200ms（简单查询）
  - API 响应 P95 ≤ 500ms（复杂操作）
  - 页面首次内容绘制（FCP）≤ 1.5s
  - 页面可交互时间（TTI）≤ 3s

- **资源限制**：
  - 前端包体积 ≤ 300KB（gzip 压缩后）
  - 单页面内存使用 ≤ 100MB
  - 图片必须优化并使用现代格式（WebP/AVIF）

- **可扩展性**：
  - 系统必须支持水平扩展
  - 数据库查询必须有适当索引，禁止全表扫描
  - 关键操作必须实现缓存策略

- **监控和可观测性**：
  - 必须实现结构化日志记录
  - 关键性能指标必须有监控告警
  - 必须支持分布式追踪（如适用）

**性能预算：**

| 指标 | 目标值 | 警告阈值 | 失败阈值 |
|-----|-------|---------|---------|
| LCP | ≤ 2.5s | 3.0s | 4.0s |
| FID | ≤ 100ms | 200ms | 300ms |
| CLS | ≤ 0.1 | 0.15 | 0.25 |
| TTFB | ≤ 200ms | 400ms | 600ms |

**理由**：性能直接影响用户体验和业务转化率，必须作为核心质量指标持续监控。

## Quality Gates

所有代码变更必须通过以下质量门禁才能合并：

**提交前检查（Pre-commit）：**

1. ✅ 代码格式化检查通过
2. ✅ Linter 检查无错误
3. ✅ 类型检查通过
4. ✅ 单元测试全部通过

**合并前检查（Pre-merge）：**

1. ✅ 所有 CI 流水线通过
2. ✅ 代码审查获得至少一位审批
3. ✅ 测试覆盖率不低于基线
4. ✅ 无安全漏洞（依赖扫描通过）
5. ✅ 性能基准测试无回归

**发布前检查（Pre-release）：**

1. ✅ 端到端测试通过
2. ✅ 无障碍性测试通过
3. ✅ 性能测试符合预算
4. ✅ 变更日志已更新

## Development Workflow

### 分支策略

- **main**：生产就绪代码，受保护分支
- **develop**：开发集成分支
- **feature/xxx**：功能开发分支
- **bugfix/xxx**：缺陷修复分支
- **release/x.x.x**：发布准备分支

### 提交规范

使用语义化提交消息格式：

```
<type>(<scope>): <subject>

类型: feat, fix, docs, style, refactor, perf, test, build, ci, chore
```

### 代码审查要求

- 审查者必须理解变更的上下文和目的
- 审查必须验证宪法原则的遵守情况
- 审查反馈必须建设性且可操作

## Governance

### 宪法效力

本宪法是项目开发的最高指导原则，所有技术决策必须符合本文档规定。当其他文档或实践与本宪法冲突时，以本宪法为准。

### 修订程序

1. **提案**：任何团队成员可提出修订提案，需说明修订原因和影响
2. **讨论**：提案必须经过团队讨论，收集反馈和异议
3. **审批**：重大修订（MAJOR）需技术负责人批准
4. **迁移**：破坏性变更必须附带迁移计划和时间表
5. **公示**：修订生效前必须通知所有团队成员

### 版本控制策略

采用语义化版本控制：

- **MAJOR**：原则删除或重新定义（不兼容变更）
- **MINOR**：新增原则或章节，扩展现有指导
- **PATCH**：措辞修正、格式调整、非语义性改进

### 合规审查

- 代码审查必须包含宪法合规检查
- 定期（每季度）审查宪法与实践的一致性
- 发现偏离时必须记录并制定整改计划

**Version**: 1.0.0 | **Ratified**: 2026-01-12 | **Last Amended**: 2026-01-12
